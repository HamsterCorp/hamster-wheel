<!doctype html>
<html>
<head>
    <title>My fancy game</title>
</head>
<body>

<!-- The canvas has an id which allows it to be found by JavaScript -->
<canvas id="canvas" style="border:1px solid #000"></canvas>
<script>

//Come back to this about how this works
//It looks like it is setting what requestAnimationFrame is depeding on the circumstance
(function() {
    var requestAnimationFrame = window.requestAnimationFrame ||
    window.mozRequestAnimationFrame ||
    window.webkitRequestAnimationFrame ||
    window.msRequestAnimationFrame;
    window.requestAnimationFrame = requestAnimationFrame;
})();

// We create a canvas variable which is the htm canvas element discovered by Javascript
// We create a context variable to hold on to the context. The getContext("2d")
var canvas = document.getElementById("canvas"),
    ctx = canvas.getContext("2d"),
    width = 500,
    height = 200,
    player = {   //The player object
      x : width/2,
      y : height - 5,
      width : 5,   // player width
      height : 5,  // player height
      speed: 3,   // how many 3  JUMPING SPEED
      velX: 0,
      velY: 0,
      jumping: false  // jumping or not
    },
    keys = [],
    friction = 0.8,  // how easily move left and right.  SLIPPERINESS!
    gravity = 0.3;  //0 means keep floating up, .7 means barely jump (heavy gravity) -0.3


// var canvas = document.getElementById("canvas");
// var ctx = canvas.getContext("2d");
// var width = 500;
// var height = 200;
// var player = {
//       x : width/2,
//       y : height - 5,
//       width : 5,
//       height : 5,
//       speed: 3,
//       velX: 0,
//       velY: 0,
//       jumping: false
//     };
// var keys = [];
// var friction = 0.8;
// var gravity = 0.3;

canvas.width = width;
canvas.height = height;

// Called everytime you have a new frame, this will happen 60 times
function update(){
  // check keys
    if (keys[38] || keys[32]) {
        // up arrow or space
      if(!player.jumping){  // if player.jumping = false
       player.jumping = true;
       player.velY = -player.speed*2; //Negative so it can be lessened by the gravity, which is a positive number and a fraction
      }
    }
    if (keys[39]) {
        // right arrow
        if (player.velX < player.speed) {
            player.velX++;
        }
    }
    if (keys[37]) {
        // left arrow
        if (player.velX > -player.speed) {
            player.velX--;
        }
    }

    player.velX *= friction;

    player.velY += gravity;

    player.x += player.velX;  // This is where the block moves left and right
    player.y += player.velY;  // This is a new position each frame, it looks fast when player.velY is big because it's skipping that many spaces

    // Not go off the screen in the left and right direction
    if (player.x >= width-player.width) {
        player.x = width-player.width;
    } else if (player.x <= 0) {
        player.x = 0;
    }


    // Come back later, how to prevent falling off the screen at high speeds
    // Not go of the screen in the up or down direction
    if(player.y >= height-player.height){
        player.y = height - player.height;
        player.jumping = false;
    }

  ctx.clearRect(0,0,width,height);
  ctx.fillStyle = "red";
  ctx.fillRect(player.x, player.y, player.width, player.height);

  // method tells the browser that you wish to perform an animation and requests that
  // the browser call a specified function to update an animation before the next repaint.
  // The method takes as an argument a callback to be invoked before the repaint.
  requestAnimationFrame(update);
}

//The EventTarget.addEventListener() method registers the specified listener on the EventTarget it's called on
// target.addEventListener(type, listener[, options]);
// The type "keydown" event happens when a key is pressed down
// The type "keyup" event happens when the key is released
document.body.addEventListener("keydown", function(e) {
    keys[e.keyCode] = true;   // e.keycode will return the ascii code for
});

document.body.addEventListener("keyup", function(e) {
    keys[e.keyCode] = false;
});


window.addEventListener("load",function(){
    update();
});
</script>
</body>
</html>
